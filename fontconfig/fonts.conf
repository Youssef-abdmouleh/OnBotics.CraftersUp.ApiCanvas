<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<!--
  Fontconfig Configuration for node-canvas + Pango
  This tells Pango/Fontconfig where to find dynamically loaded fonts

  CRITICAL: This allows fonts in /tmp/canvas-fonts/ to be used without
  installing them in the system fonts directory.

  The CUSTOM_FONT_DIR environment variable is set in app.ts
-->
<fontconfig>
  <!-- Custom font directory (set via environment variable) -->
  <dir prefix="env">CUSTOM_FONT_DIR</dir>

  <!-- Fallback: Scan default temp font directory -->
  <dir>/tmp/canvas-fonts</dir>

  <!-- Cache directory for fontconfig -->
  <cachedir>/tmp/fontconfig-cache</cachedir>

  <!-- Rescan font directories on every run (important for dynamic loading) -->
  <rescan>
    <int>30</int> <!-- Rescan every 30 seconds -->
  </rescan>

  <!-- Accept all font formats -->
  <acceptfont>
    <pattern>
      <patelt name="scalable"><bool>true</bool></patelt>
    </pattern>
  </acceptfont>

  <!-- Debugging: Set to true to see fontconfig logs -->
  <match target="pattern">
    <test qual="any" name="family">
      <string/>
    </test>
    <edit name="embeddedbitmap" mode="assign">
      <bool>false</bool>
    </edit>
  </match>
</fontconfig>
